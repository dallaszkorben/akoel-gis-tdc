MAP
	NAME		EX2_
	IMAGETYPE	png24
	EXTENT	645210 227752 645689 228030
	#EXTENT	419500 24000 945000 365925
	#EXTENT		645407 227808 645670 227959
	SIZE		600 350
	SHAPEPATH 	"../data"
	SYMBOLSET	"../symbols/symbols35.sym"
	FONTSET	"../fonts/fonts.list"

	TEMPLATEPATTERN 'example*'

	CONFIG "MS_ERRORFILE" "tmp/ms_error.txt"

	#Azert kell, hogy a layer-ek atlatszoak legyenek
	OUTPUTFORMAT
		NAME "png"
		DRIVER AGG/PNG
		MIMETYPE "image/png"
		IMAGEMODE RGBA
		EXTENSION "png"
		TRANSPARENT ON
#		FORMATOPTION "GAMMA=0.25"
#		FORMATOPTION "INTERLACE=OFF"
	END

	WEB
		TEMPLATE  'to be replaced by map_web_template variable in section2.html'
		IMAGEPATH '/home/akoel/Projects/tdc/svn/www/htdocs/tmp/'
		IMAGEURL  '/tdc/htdocs/tmp/'
    
		METADATA
			"ows_enable_request" "*"
			"wms_title"		"Sajat WMS szerverem"
			"wms_onlineresource"	"http://localhost/cgi-bin/mapserv?map=/home/akoel/Projects/tdc/svn/www/htdocs/tdc.map"
			"wms_srs"		"EPSG:23700"
			"wms_feature_info_mime_type" "text/html"
		END
	END 

	PROJECTION
		"init=epsg:2370"
	END





	#////////////////////////////////////////////////////////////////////
	#///////////////////////////////////////////////////////////////////
	#//////////////////////////                          //////////////////////////
	#/////////////////////////   UNDERPASS   //////////////////////////
	#////////////////////////                          //////////////////////////
	#///////////////////////////////////////////////////////////////
	#//////////////////////////////////////////////////////////////

    ##########################
    ##########   Underpass   ########
	#########################
	######                                  #####
	#####        IDENTIFY        ######
	####                                  ######
	######################

	LAYER
		NAME "identify_underpass"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "identify_geom FROM main.identify_underpass() USING UNIQUE identify_nid USING srid=2370"
		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		#Lekerdezeshez szukseges tempalte fajl, specialis formaban
		TEMPLATE 'templates/identify_underpass.html'
	END #layer

    ##########################
    ##########   Underpass   ########
	#########################
	######                                   #####
	#####     QUERY OWNER   ######
	####                                 ######
	######################

	LAYER
		NAME "query_owner_underpass"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_owner_underpass( %selected_nid% ) d, main.tp_face AS f WHERE d.found_projection=f.gid ) AS subquery  USING UNIQUE owner_name USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"selected_nid"  "^[0-9]+$"						#Ez a parameter mondja meg, hogy melyik aluljárót keresem
		END

		HEADER 'templates/query_header_owner.html'
		TEMPLATE 'templates/query_body_owner.html'
		FOOTER 'templates/query_footer_owner.html'

	END #layer

    ##########################
    ##########   Underpass   ########
	##########################
	######                                  ######
	#####  QUERY 3D POINTS  ######
	####                                    ######
	#######################
	LAYER
		NAME "query_object_points_underpass"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_object_points_underpass( %selected_nid% ) d, main.tp_face AS f WHERE d.found_projection=f.gid  ) AS subquery  USING UNIQUE point_name USING srid=2370"
                                                  
		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"selected_nid"  "^[0-9]+$"										#Ez a parameter mondja meg, hogy melyik aluljárót keresem
		END

		HEADER 'templates/query_header_object_points.html'
		TEMPLATE 'templates/query_body_object_points.html'
		FOOTER 'templates/query_footer_object_points.html'

	END #layer

    ##########################
    ##########   Underpass   ########
	#########################
	########                         #######
	#######     VIEW           #######
	######                          #######
	######################

	LAYER
		NAME "view_underpass"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "view_geom FROM main.view_underpass(  '%visible_underpass_level%' ) USING UNIQUE view_nid USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1

		PROJECTION
			"init=epsg:2370"
		END

		VALIDATION
			"visible_underpass_level"  "^.+$"								#Ez a parameter mondja meg, hogy melyik aluljárószint latszodhat
			"visible_object" "^[0-3]$"										#3-underpass, underpass_levels, underpass_unit, 2-underpass, underpass_levels, 1-underpass
			"selected_nid"  "^[0-9]+$"										#Kiemelés esetén az objektum azonosítója
			"selected_name"  "^.+$"												#Kiemelés esetén az objektum neve (im_underpass, im_underpass_leveles, im_underpass_indvidual_unit)
		END

		LABELMAXSCALEDENOM 1140
		PROCESSING "LABEL_NO_CLIP=True"

		#=========================
		#=========================
		# KIEMELT OBJEKTUMOK	
		#=========================
		#=========================

		#--------------------------
		# Aluljáró		
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='1' AND '[view_name]'='%selected_name%' AND '[view_nid]'='%selected_nid%' AND '[view_name]'='im_underpass' ) 
			NAME "normal"
			STYLE
				COLOR 0 13 143
			END
			STYLE
#				OUTLINECOLOR 0 4 42
				OUTLINECOLOR 255 255 0
				WIDTH 3
			END
			TEXT '[view_hrsz]'
			LABEL    
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 255 255 255                           
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

		#--------------------------
		# Aluljáró szintek
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='2' AND '[view_name]'='%selected_name%' AND '[view_nid]'='%selected_nid%' AND '[view_name]'='im_underpass_levels' ) 
			NAME "normal"
			STYLE
				COLOR 62 26 203
			END
			STYLE
#				OUTLINECOLOR 22 10 73
				OUTLINECOLOR 255 255 0
				WIDTH 3
			END
		END #class

		#--------------------------
		# Individual unit
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='3' AND '[view_name]'='%selected_name%' AND '[view_nid]'='%selected_nid%' AND '[view_name]'='im_underpass_individual_unit' ) 
			NAME "normal"
			STYLE
				COLOR 0 90 109
			END
			STYLE
#				OUTLINECOLOR 0 32 39
				OUTLINECOLOR 255 255 0
				WIDTH 3
			END
			TEXT '[view_hrsz]'
			LABEL    
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 255 255 255                       
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

		#--------------------------
		# Shared unit
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='3' AND '[view_name]'='%selected_name%' AND '[view_nid]'='%selected_nid%' AND '[view_name]'='im_underpass_shared_unit' ) 
			NAME "normal"
			STYLE
				COLOR 113 0 130
			END
			STYLE
#				OUTLINECOLOR 40 0 46
				OUTLINECOLOR 255 255 0
				WIDTH 3
			END
			TEXT '[view_hrsz]'
			LABEL    
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 255 255 255                           
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

		#=========================
		#=========================
		# NORMAL OBJEKTUMOK	
		#=========================
		#=========================

		#--------------------------
		# Aluljáró		
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='1' AND '[view_name]'='im_underpass' ) 
			NAME "normal"
			STYLE
				COLOR 109 152 255
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END
			TEXT '[view_hrsz]'
			LABEL    
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 0 0 0                           
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

		#--------------------------
		# Aluljáró szintek
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='2' AND '[view_name]'='im_underpass_levels' ) 
			NAME "normal"
			STYLE
				COLOR 0 65 229
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END
		END #class

		#--------------------------
		# Individual unit
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='3' AND '[view_name]'='im_underpass_individual_unit' ) 
			NAME "normal"
			STYLE
				COLOR 0 140 142
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END
			TEXT '[view_hrsz]'
			LABEL    
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 0 0 0                           
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

		#--------------------------
		# Shared unit
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='3' AND '[view_name]'='im_underpass_shared_unit' ) 
			NAME "normal"
			STYLE
				COLOR 145 78 255
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END
			TEXT '[view_hrsz]'
			LABEL    
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 0 0 0                           
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

	END #layer



	#////////////////////////////////////////////////////////////////////
	#///////////////////////////////////////////////////////////////////
	#/////////////////                                                          /////////////////
	#////////////////  UNDERPASS  INDIVIDUAL UNIT   /////////////////
	#///////////////                                                          /////////////////
	#///////////////////////////////////////////////////////////////
	#//////////////////////////////////////////////////////////////

    ##########################
    ###### Underpass individual unit #####
	#########################
	########                           ######
	#######     IDENTIFY     ######
	######                           ######
	#####################

	LAYER
		NAME "identify_underpass_individual_unit"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "identify_geom FROM main.identify_underpass_individual_unit() USING UNIQUE identify_nid USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END

		TEMPLATE 'templates/identify_underpass_individual_unit.html'
	END #layer

    ##########################
    ###### Underpass individual unit #####
	#########################
	######                                   #####
	#####     QUERY OWNER   ######
	####                                 ######
	######################

	LAYER
		NAME "query_owner_underpass_individual_unit"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_owner_underpass_individual_unit( %selected_nid%, '%visible_underpass_level%' ) d, main.tp_face AS f WHERE d.found_projection=f.gid ) AS subquery  USING UNIQUE owner_name USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"visible_underpass_level"  "^.+$"				#Ez a parameter mondja meg, hogy melyik aluljárószint latszodhat
			"selected_nid"  "^[0-9]+$"						#Ez a parameter mondja meg, hogy melyik közös tulajdonú helyiséget keresem
		END

		HEADER 'templates/query_header_owner.html'
		TEMPLATE 'templates/query_body_owner.html'
		FOOTER 'templates/query_footer_owner.html'

	END #layer

    ##########################
    ###### Underpass individual unit #####
	##########################
	######                                     #####
	#####  QUERY 3D POINTS  ######
	####                                    ######
	#######################
	LAYER
		NAME "query_object_points_underpass_individual_unit"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_object_points_underpass_individual_unit( %selected_nid%, '%visible_underpass_level%' ) d, main.tp_face AS f WHERE d.found_projection=f.gid  ) AS subquery  USING UNIQUE point_name USING srid=2370"
                                                  
		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"visible_underpass_level"  "^.+$"								#Ez a parameter mondja meg, hogy melyik aluljáró szint latszodik
			"selected_nid"  "^[0-9]+$"										#Ez a parameter mondja meg, hogy melyik üzlethelyiséget keresem
		END

		HEADER 'templates/query_header_object_points.html'
		TEMPLATE 'templates/query_body_object_points.html'
		FOOTER 'templates/query_footer_object_points.html'

	END #layer

	#////////////////////////////////////////////////////////////////////
	#///////////////////////////////////////////////////////////////////
	#/////////////////                                                          /////////////////
	#////////////////      UNDERPASS  SHARED UNIT      /////////////////
	#///////////////                                                          /////////////////
	#///////////////////////////////////////////////////////////////
	#//////////////////////////////////////////////////////////////

    ##########################
    ####### Underpass shared unit   #####
	#########################
	########                           ######
	#######     IDENTIFY    #######
	######                           #######
	######################

	LAYER
		NAME "identify_underpass_shared_unit"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "identify_geom FROM main.identify_underpass_shared_unit() USING UNIQUE identify_nid USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END

		TEMPLATE 'templates/identify_underpass_shared_unit.html'
	END #layer

    ##########################
    ####### Underpass shared unit   #####
	#########################
	######                                   #####
	#####     QUERY OWNER   ######
	####                                 ######
	######################

	LAYER
		NAME "query_owner_underpass_shared_unit"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_owner_underpass_shared_unit( %selected_nid%, '%visible_underpass_level%' ) d, main.tp_face AS f WHERE d.found_projection=f.gid ) AS subquery  USING UNIQUE owner_name USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"visible_underpass_level"  "^.+$"				#Ez a parameter mondja meg, hogy melyik aluljárószint latszodhat
			"selected_nid"  "^[0-9]+$"						#Ez a parameter mondja meg, hogy melyik közös tulajdonú helyiséget keresem
		END

		HEADER 'templates/query_header_owner.html'
		TEMPLATE 'templates/query_body_owner.html'
		FOOTER 'templates/query_footer_owner.html'

	END #layer

    ##########################
    ####### Underpass shared unit   #####
	##########################
	######                                     #####
	#####  QUERY 3D POINTS  ######
	####                                    ######
	#######################
	LAYER
		NAME "query_object_points_underpass_shared_unit"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_object_points_underpass_shared_unit( %selected_nid%, '%visible_underpass_level%' ) d, main.tp_face AS f WHERE d.found_projection=f.gid  ) AS subquery  USING UNIQUE point_name USING srid=2370"
                                                  
		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"visible_underpass_level"  "^.+$"								#Ez a parameter mondja meg, hogy melyik aluljáró szint latszodik
			"selected_nid"  "^[0-9]+$"										#Ez a parameter mondja meg, hogy melyik üzlethelyiséget keresem
		END

		HEADER 'templates/query_header_object_points.html'
		TEMPLATE 'templates/query_body_object_points.html'
		FOOTER 'templates/query_footer_object_points.html'

	END #layer

	#////////////////////////////////////////////////////////////////////
	#///////////////////////////////////////////////////////////////////
	#//////////////////////////                          //////////////////////////
	#/////////////////////////       PARCEL       //////////////////////////
	#////////////////////////                          //////////////////////////
	#///////////////////////////////////////////////////////////////
	#//////////////////////////////////////////////////////////////

    ##########################
    ##########  Parcel  ###########
	#########################
	######                                 #####
	#####        IDENTIFY        #####
	####                                 #####
	#####################

	LAYER
		NAME "identify_parcel"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"
		DATA "identify_geom FROM main.identify_parcel() USING UNIQUE identify_nid USING srid=2370"
		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END

		#Lekerdezeshez szukseges tempalte fajl, specialis formaban
		TEMPLATE 'templates/identify_parcel.html'
	END #layer

    ##########################
    ##########  Parcel  ###########
	#########################
	######                                  #####
	#####     QUERY OWNER    #####
	####                                    #####
	######################

	LAYER
		NAME "query_owner_parcel"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_owner_parcel( %immovable_type%,  %selected_nid% ) d, main.tp_face AS f WHERE d.found_projection=f.gid ) AS subquery  USING UNIQUE owner_name USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"selected_nid"  "^[0-9]+$"			#Ez a parameter mondja meg, hogy melyik foldteruletet keresem
			"immovable_type" "^[0-9]+$"		#Ez a parameter mondja meg, hogy milyen típusú az ingatlan. Ez kiderült az identifikáció során
		END

		HEADER 'templates/query_header_owner.html'
		TEMPLATE 'templates/query_body_owner.html'
		FOOTER 'templates/query_footer_owner.html'

	END #layer

    ################################
    ##########  Parcel  #################
	################################
	######                                                   ######
	#####  QUERY PROJECTION POINTS ######
	####                                                    ######
	#############################
	LAYER
		NAME "query_projection_points_parcel"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_projection_points_parcel(%selected_nid%) d, main.tp_face AS f WHERE d.found_projection=f.gid ) AS subquery  USING UNIQUE point_name USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"selected_nid"  "^[0-9]+$"		#Ez a parameter mondja meg, hogy melyik foldteruletet keresem
		END

		HEADER 'templates/query_header_projection_points.html'
		TEMPLATE 'templates/query_body_projection_points.html'
		FOOTER 'templates/query_footer_projection_points.html'

	END #layer

    ##########################
    ##########  Parcel  ###########
	#########################
	########                           ######
	#######     VIEW           #######
	######                           #######
	######################

	LAYER
		NAME "view_parcel"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "view_geom FROM main.view_parcel() USING UNIQUE view_nid USING srid=2370"
		STATUS OFF #DEFAULT
		TYPE POLYGON

		PROJECTION
			"init=epsg:2370"
		END

		VALIDATION
			"selected_nid"  "^[0-9]+$"		#!!! Ez kell, mert kulonben nem lenne ervenyes az EXPRESSION parameteratadas
		END

		PROCESSING "CLOSE_CONNECTION=DEFER"
		PROCESSING "LABEL_NO_CLIP=True"

		#-----------------------------
		#-----------------------------
		# ---- ELEM KIEMELÉS ----
		#-----------------------------
		#-----------------------------

		#--------------------------
		# Kiemelt Utak
		#--------------------------
		CLASS
			NAME "highlited"
			EXPRESSION( '[view_nid]'='%selected_nid%' AND '[view_cultivation_nid]'='11')
			STYLE
				COLOR 100 100 100				
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 3
			END
			TEXT '[view_hrsz]  (Út)'
			LABEL
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 255 255 255                           
				SIZE 11
				FORCE FALSE
				PARTIALS FALSE
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC					
			END #label
		END #class

		#--------------------------
		# Kiemelt Egyéb földrészletek
		#--------------------------
		CLASS
			NAME "highlited"
			EXPRESSION( '[view_nid]'='%selected_nid%' AND '[view_cultivation_nid]'!='11')
			STYLE
				COLOR 80 150 80
			END
			STYLE
				OUTLINECOLOR 0 100 0
				WIDTH 3
			END
			TEXT '[view_hrsz]'
			LABEL    
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 255 255 255                           
				SIZE 11
				FORCE FALSE
				PARTIALS FALSE
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC					
			END #label
		END #class

		#-------------------------------
		#-------------------------------
		# ---- NORMÁL ELEMEK ----
		#-------------------------------
		#-------------------------------

		#--------------------------
		#  Utak
		#--------------------------
		CLASS
			NAME "ut"
			MINSCALEDENOM 283			  						#Egy bizonyos nagyítás felett eltünik az út és takarás nélkül látszik az aluljáró
			EXPRESSION( '[view_cultivation_nid]'='11'  ) 
			STYLE
				COLOR 150 150 150
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END
			#A megjelenitendo hrsz formatuma
			TEXT '[view_hrsz]  (Út)'
			LABEL
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 255 0 0                           
				SIZE 11
				FORCE FALSE
				PARTIALS FALSE
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC					
				MINDISTANCE 500
			END #label
		END #class

		#----------------------------
		#  Egyéb földrészletek
		#----------------------------
		CLASS
			NAME "normal"
			EXPRESSION( '[view_cultivation_nid]'!='11')
			STYLE
				COLOR 100 255 100
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END

			#A megjelenitendo hrsz formatuma
			TEXT '[view_hrsz]'
			LABEL    
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 255 0 0                           
				SIZE 11
				FORCE FALSE
				PARTIALS FALSE
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC					
				MINDISTANCE 500
			END #label
		END #class
	END #layer


	#///////////////////////////////////////////////////////////////////
	#///////////////////////////////////////////////////////////////////
	#//////////////////////////                          //////////////////////////
	#/////////////////////////    BUILDING     ///////////////////////////
	#////////////////////////                          ////////////////////////////
	#//////////////////////////////////////////////////////////////////
	#//////////////////////////////////////////////////////////////////

    ##########################
    #########  Building  ###########
	#########################
	######                                   #####
	#####        IDENTIFY        ######
	####                                 ######
	######################

	LAYER
		NAME "identify_building"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "identify_geom FROM main.identify_building() USING UNIQUE identify_nid USING srid=2370"
		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		#Lekerdezeshez szukseges tempalte fajl, specialis formaban
		TEMPLATE 'templates/identify_building.html'
	END #layer

    ##########################
    #########  Building  ###########
	#########################
	######                                  #####
	#####  QUERY OWNER     ######
	####                                 ######
	######################

	LAYER
		NAME "query_owner_building"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_owner_building(%immovable_type%, %selected_nid% ) d, main.tp_face AS f WHERE d.found_projection=f.gid ) AS subquery  USING UNIQUE owner_name USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"selected_nid"  "^[0-9]+$"					#Ez a parameter mondja meg, hogy melyik epuletet keresem
			"immovable_type" "^[0-9]+$"				#Ez a parameter mondja meg, hogy milyen típusú az ingatlan. Ez kiderült az identifikáció során
		END

		HEADER 'templates/query_header_owner.html'
		TEMPLATE 'templates/query_body_owner.html'
		FOOTER 'templates/query_footer_owner.html'

	END #layer

    ##############################
    ###########  Building  #############
	##############################
	######                                                    ####
	#####  QUERY PROJECTION POINTS  ####
	####                                                      ####
	############################
	LAYER
		NAME "query_projection_points_building"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_projection_points_building(%selected_nid%) d, main.tp_face AS f WHERE d.found_projection=f.gid ) AS subquery  USING UNIQUE point_name USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"selected_nid"  "^[0-9]+$"		#Ez a parameter mondja meg, hogy melyik foldteruletet keresem
		END

		HEADER 'templates/query_header_projection_points.html'
		TEMPLATE 'templates/query_body_projection_points.html'
		FOOTER 'templates/query_footer_projection_points.html'

	END #layer

    ###########################
    #########  Building  ############
	###########################
	###                                                   ####
	###   QUERY 3D OBJECT POINTS  ####
	###                                                 ####
	#########################
	LAYER
		NAME "query_object_points_building"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_object_points_building(%selected_nid%) d, main.tp_face AS f WHERE d.found_projection=f.gid ) AS subquery  USING UNIQUE point_name USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"selected_nid"  "^[0-9]+$"		#Ez a parameter mondja meg, hogy melyik foldteruletet keresem
		END

		HEADER 'templates/query_header_object_points.html'
		TEMPLATE 'templates/query_body_object_points.html'
		FOOTER 'templates/query_footer_object_points.html'

	END #layer

	#########################
	########                           ######
	#######     VIEW              ######
	######                             ######
	######################
	LAYER
		NAME "view_building"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"
		DATA "view_geom FROM main.view_building( '%visible_building_level%', %visible_object% )  USING UNIQUE view_nid USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"visible_building_level"  "^.+$"									#Ez a parameter mondja meg, hogy melyik epuletszint latszodhat
			"selected_nid"  "^[0-9]+$"										#Ez a parameter mondja meg, hogy melyik unitot emeljuk ki
			"selected_name"  "^.+$"
			"visible_object" "^[0-3]$"										#3-building, building_levels, building_unit, 2-building, building_levels, 1-building
		END

		LABELMAXSCALEDENOM 1140
		PROCESSING "LABEL_NO_CLIP=True"

		#=========================
		#=========================
		# KIEMELT OBJEKTUMOK	
		#=========================
		#=========================

		#--------------------------
		# Épület	
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='1' AND '[view_name]'='%selected_name%' AND '[view_nid]'='%selected_nid%' AND '[view_name]'='im_building' ) 
			NAME "building_selected"
			STYLE
				COLOR 157 159 18
			END
			STYLE
				OUTLINECOLOR 93 94 3
				WIDTH 3
			END
			TEXT '[view_hrsz]'
			LABEL
				EXPRESSION( [visible_object]<3 )   
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 255 255 255                           
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

		#--------------------------
		# Épület szintek
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='2' AND '[view_name]'='%selected_name%' AND '[view_nid]'='%selected_nid%' AND '[view_name]'='im_building_levels') 
			NAME "building_levels_selected"
			STYLE
				COLOR 51 41 126
			END
			STYLE
				OUTLINECOLOR 14 7 70
				WIDTH 3
			END
		END #class

		#--------------------------
		# Individual unit
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='3' AND '[view_name]'='%selected_name%' AND '[view_nid]'='%selected_nid%' AND '[view_name]'='im_building_individual_unit' ) 
			NAME "building_individual_unit_selected"
			STYLE
				COLOR 68 55 33
			END
			STYLE
				OUTLINECOLOR 30 23 11
				WIDTH 1
			END
			TEXT '[view_hrsz]'
			LABEL    
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 255 255 255                       
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

		#=========================
		#=========================
		# NORMAL OBJEKTUMOK	
		#=========================
		#=========================

		#--------------------------
		# Épület		
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='1' AND '[view_name]'='im_building') 
			NAME "building_normal"
			STYLE
				COLOR 217 219 88
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END
			TEXT '[view_hrsz]'
			LABEL  

				#trükközni kellett, mert a %visible_object% az itteni EXPRESSION-ban nem működik :(
				#lehet, hogy a következő verzióban kijavul
				EXPRESSION( [visible_object]<3 )   
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 0 0 0                           
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

		#--------------------------
		# Épület szintek
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='2' AND '[view_name]'='im_building_levels'  ) 
			NAME "building_levels_normal"
			STYLE
				COLOR 215 152 0
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END
#			TEXT '[view_hrsz]'
#			LABEL  
#				EXPRESSION( '%visible_object%'='2' )   
#				ANGLE [view_angle]    #hrsz dolesszoge
#				COLOR 0 0 0                           
#				FONT arial-bold
#				TYPE TRUETYPE
#				POSITION CC			
#				SIZE 9
#			END #label
		END #class

		#--------------------------
		# Individual unit
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='3' AND '[view_name]'='im_building_individual_unit'  ) 
			NAME "building_individual_unit_normal"
			STYLE
				COLOR 136 99 11
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END
			TEXT '[view_hrsz]'
			LABEL    
				ANGLE [view_angle]    #hrsz dolesszoge
				COLOR 0 0 0                           
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

		#--------------------------
		# Shared unit
		#--------------------------
		CLASS
			EXPRESSION( '%visible_object%'>='3' AND '[view_name]'='im_building_shared_unit' ) 
			NAME "building_shared_unit_normal"
			STYLE
				COLOR 190 110 40
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END			
			TEXT '[view_hrsz]'		#valójában elnevezés
			LABEL    
				ANGLE [view_angle]    #elnevezés dolesszoge
				COLOR 0 0 0                           
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CC			
				SIZE 11
			END #label
		END #class

	END #layer


	#//////////////////////////////////////////////
	#/////////////////////////////////////////////
	#//////////                                               ////////
	#////////  TARSASHAZAK UNIT-JAI    ////////
	#///////                                                ////////
	#/////////////////////////////////////////
	#////////////////////////////////////////


	#########################
	########                           ######
	#######     IDENTIFY     #######
	######                           #######
	######################

	LAYER
		NAME "identify_building_individual_unit"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "identify_geom FROM main.identify_building_individual_unit() USING UNIQUE identify_nid USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		#Lekerdezeshez szukseges tempalte fajl, specialis formaban
		TEMPLATE 'templates/identify_building_individual_unit.html'
	END #layer

	########################
	######                                 #####
	#####  QUERY OWNER    ######
	####                                 ######
	######################

	LAYER
		NAME "query_owner_building_individual_unit"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_owner_building_individual_unit( %selected_nid%, '%visible_building_level%' ) d, main.tp_face AS f WHERE d.found_projection=f.gid ) AS subquery  USING UNIQUE owner_name USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"visible_building_level"  "^.+$"				#Ez a parameter mondja meg, hogy melyik epuletszint latszodhat
			"selected_nid"  "^[0-9]+$"					#Ez a parameter mondja meg, hogy melyik lakast keresem
		END

		HEADER 'templates/query_header_owner.html'
		TEMPLATE 'templates/query_body_owner.html'
		FOOTER 'templates/query_footer_owner.html'

	END #layer

	##########################
	######                                     #####
	#####  QUERY 3D POINTS  ######
	####                                    ######
	#######################
	LAYER
		NAME "query_object_points_building_individual_unit"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT * FROM main.query_object_points_building_individual_unit( %selected_nid%, '%visible_building_level%' ) d, main.tp_face AS f WHERE d.found_projection=f.gid  ) AS subquery  USING UNIQUE point_name USING srid=2370"
                                                  
		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"visible_building_level"  "^.+$"								#Ez a parameter mondja meg, hogy melyik epuletszint latszodhat
			"selected_nid"  "^[0-9]+$"									#Ez a parameter mondja meg, hogy melyik lakast keresem
		END

		HEADER 'templates/query_header_object_points.html'
		TEMPLATE 'templates/query_body_object_points.html'
		FOOTER 'templates/query_footer_object_points.html'

	END #layer



	#////////////////////////////////////////////////////////////////
	#////////////////////////////////////////////////////////////////
	#////////////////////                                //////////////////////////
	#///////////////////          POINT           ///////////////////////////
	#//////////////////                                ////////////////////////////
	#////////////////////////////////////////////////////////////////
	#////////////////////////////////////////////////////////////////

	########################
	######                                 #####
	#####        IDENTIFY        ######
	####                                 ######
	######################

	LAYER
		NAME "identify_point"
		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "identify_geom FROM (SELECT * FROM main.identify_point('%visible_building_level%', '%visible_underpass_level%' ) ) AS subquery USING UNIQUE identify_nid USING srid=2370"
		STATUS OFF
		TYPE POINT
		TOLERANCE 6
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"visible_underpass_level"  "^.+$"		#Ez a parameter mondja meg, hogy melyik aluljárószint látszódhat
			"visible_building_level"  "^.+$"			#Ez a parameter mondja meg, hogy melyik épületszint létszódhat
		END
		#Lekerdezeshez szukseges tempalte fajl, specialis formaban
		TEMPLATE 'templates/identify_point.html'
	END #layer

	#########################
	########                           ######
	#######     VIEW           #######
	######                           #######
	#######################

	LAYER
		NAME "view_point"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "view_geom FROM main.view_point( '%visible_building_level%', '%visible_underpass_level%' )  USING UNIQUE view_nid USING srid=2370"

		STATUS OFF
		TYPE POINT
		PROJECTION
			"init=epsg:2370"
		END
		VALIDATION
			"selected_nid"  "^[0-9]+$"						#!!! Ez kell, mert kulonben nem lenne ervenyes az EXPRESSION parameteratadas
			"visible_underpass_level"  "^.+$"		#Ez a parameter mondja meg, hogy melyik aluljárószint látszódhat
			"visible_building_level"  "^.+$"			#Ez a parameter mondja meg, hogy melyik épületszint létszódhat
		END

		LABELMAXSCALEDENOM 800

		#--------------------------
		# Kiemelt elemek		
		#--------------------------
		CLASSITEM "view_nid"	
		CLASS
			NAME "highlited"
			EXPRESSION  "%selected_nid%"  
			STYLE
				SYMBOL 'circle'
				COLOR 255 255 0
				OUTLINECOLOR 255 255 0
				WIDTH 7
			END

			TEXT '[view_name]'
			LABEL    
				COLOR 255 255 0
				FORCE FALSE
				PARTIALS TRUE
				FONT arial
				SIZE 9
				TYPE TRUETYPE
				POSITION AUTO				
			END #label
		END #class

		#--------------------------
		# Normal elemek		
		#--------------------------
		CLASS
			NAME "normal"
			STYLE
				SYMBOL 'circle'
				COLOR 10 255 255
				OUTLINECOLOR 0 0 0 
				WIDTH 5
			END

			#A megjelenitendo azonosito formatuma
			TEXT '[view_name]'
			LABEL    
				COLOR 0 0 0                        
				FORCE FALSE
				PARTIALS TRUE
				FONT arial
				SIZE 9
				TYPE TRUETYPE
				POSITION AUTO				
			END #label
		END #class
	END #layer




	#////////////////////////////////////////////////////////////////
	#////////////////////////////////////////////////////////////////
	#////////////////////                                //////////////////////////
	#///////////////////          KÖZÖS          ///////////////////////////
	#//////////////////                                ////////////////////////////
	#////////////////////////////////////////////////////////////////
	#////////////////////////////////////////////////////////////////

	############################
	###                                                   ######
	###   QUERY X3D                            ######
	###                                                   ######
	#############################
	LAYER
		NAME "query_x3d"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "query_base_geom FROM main.query_x3d( %immovable_type%, %selected_name%, %selected_nid%, %selected_x%, %selected_y% )   USING UNIQUE query_object_nid USING srid=2370"

		STATUS OFF
		TYPE POINT								#Ez fontos!!!
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END

	VALIDATION
		"selected_name"  "^.+$"				#Ez a parameter mondja meg, hogy mi az kivalasztott objektum neve (im_parcel, im_building...)
		"selected_nid"  "^[0-9]+$"		#Ez a parameter mondja meg, hogy mi az kivalasztott objektum azonositoja
        "selected_x"  "^.+$"					#Ez a parameter mondja meg, hogy melyik X pozicióban válaszottam ki az elemet
        "selected_y"  "^.+$"					#Ez a parameter mondja meg, hogy melyik Y pozicióban válaszottam ki az elemet
		"immovable_type" "^[0-9]+$"	#Ez a parameter mondja meg, hogy milyen típusú az ingatlan. Ez kiderült az identifikáció során
	END

	TEMPLATE 'templates/query_x3d.html'

	END #layer

	############################
	###                                                   ######
	###   QUERY ALL X3D                      ######
	###                                                   ######
	#############################
	LAYER
		NAME "query_all_x3d"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "query_base_geom FROM main.query_all_x3d( %selected_radius%, %selected_x%, %selected_y% )   USING UNIQUE query_object_nid USING srid=2370"

		STATUS OFF
		TYPE POINT								#Ez fontos!!!
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END

	VALIDATION
		"selected_radius"  "^[0-9]+$"		#Ez a parameter mondja meg, hogy mekkora sugarú körben keressen
        "selected_x"  "^.+$"						#Ez a parameter mondja meg, hogy mi az x középpontja a keresési távolságnak
        "selected_y"  "^.+$"						#Ez a parameter mondja meg, hogy mi az x középpontja a keresési távolságnak
	END

	TEMPLATE 'templates/query_all_x3d.html'

	END #layer

 # End of LAYER DEFINITIONS -------------------------------

END # end of map file


