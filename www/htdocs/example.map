MAP
	NAME		EX2_
	IMAGETYPE	png24
	EXTENT	419500 24000 945000 365925
	#EXTENT		645407 227808 645670 227959
	SIZE		600 350
	SHAPEPATH 	"../data"
	SYMBOLSET	"../symbols/symbols35.sym"
	FONTSET	"../fonts/fonts.list"

	TEMPLATEPATTERN 'example*'

	#Azert kell, hogy a layer-ek atlatszoak legyenek
	OUTPUTFORMAT
		NAME "png"
		DRIVER AGG/PNG
		MIMETYPE "image/png"
		IMAGEMODE RGBA
		EXTENSION "png"
		TRANSPARENT ON
#		FORMATOPTION "GAMMA=0.25"
#		FORMATOPTION "INTERLACE=OFF"
	END

	WEB
		TEMPLATE  'to be replaced by map_web_template variable in section2.html'
		IMAGEPATH '/home/akoel/Projects/tdc/svn/www/htdocs/tmp/'
		IMAGEURL  '/tdc/htdocs/tmp/'
    
		METADATA
			"ows_enable_request" "*"
			"wms_title"		"Sajat WMS szerverem"
			"wms_onlineresource"	"http://localhost/cgi-bin/mapserv?map=/home/akoel/Projects/tdc/svn/www/htdocs/example.map"
			"wms_srs"		"EPSG:23700"
			"wms_feature_info_mime_type" "text/html"
		END
	END 

	PROJECTION
		"init=epsg:2370"
	END

	# Start of legend
#	LEGEND
#		KEYSIZE 12 12
#		LABEL
#			TYPE BITMAP
#			SIZE MEDIUM
#			COLOR 0 0 89
#		END
#		STATUS OFF
#	END
#
#	SCALEBAR
#		IMAGECOLOR 255 255 255
#		LABEL
#			COLOR 0 0 0
#			SIZE TINY
#		END
#		STYLE 1
#		SIZE 100 2
#		COLOR 0 0 0
#		UNITS MILES
#		INTERVALS 2
#		TRANSPARENT FALSE
#		STATUS OFF
#	END # Scalebar object ends




	#/////////////////////////////////////////////////////////
	#/////////////                  //////////////////////////
	#////////////  PARCEL  ///////////////////////////
	#///////////                  ////////////////////////////
	#/////////////////////////////////////////////////////////

	#_____________________________________
	#
	# PARCEL POLYGON for IDENTIFY
	#
	#_____________________________________

	LAYER
		NAME "parcel_identify"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"
#		DATA "geom FROM (SELECT 'im_parcel' AS selected_name, p.nid AS selected_nid, f.geom  FROM main.im_parcel AS p, main.tp_face AS f WHERE p.projection=f.gid) AS subquery USING UNIQUE selected_nid USING srid=2370"
		DATA "geom FROM (SELECT * FROM main.parcels_with_data() d, main.tp_face AS f WHERE d.selected_projection=f.gid) AS subquery USING UNIQUE selected_nid USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		#Lekerdezeshez szukseges tempalte fajl, specialis formaban
		TEMPLATE 'templates/identify.html'
	END #layer

	#_____________________________________
	#
	# PARCEL POLYGON for QUERY
	#
	#_____________________________________

	LAYER
		NAME "parcel_query"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"
		DATA "geom FROM (SELECT 'im_parcel' AS selected_name, p.nid AS selected_nid, f.geom  FROM main.im_parcel AS p, main.tp_face AS f WHERE p.projection=f.gid) AS subquery USING UNIQUE selected_nid USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END

		#Lekerdezeshez szukseges tempalte fajl, specialis formaban
		TEMPLATE 'templates/parcel_query.html'

	END #layer

	#_____________________________________
	#
	# PARCEL POLYGON for VIEW
	#
	#_____________________________________

	LAYER
		NAME "parcel_view"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT p.nid AS nid, f.geom, main.hrsz_concat(p.hrsz_main, p.hrsz_fraction ) AS hrsz, p.title_angle FROM main.im_parcel AS p, main.tp_face AS f WHERE p.projection=f.gid ) AS subquery USING UNIQUE nid USING srid=2370"

		STATUS OFF #DEFAULT
		TYPE POLYGON
		TOLERANCE 1

		PROJECTION
			"init=epsg:2370"
		END

		VALIDATION
			"parcel_nid"  "^[0-9]+$"	#!!! Ez kell, mert kulonben nem lenne ervenyes az EXPRESSION parameteratadas
		END




		#--------------------------
		# Kiemelt elemek		
		#--------------------------
		CLASSITEM "nid"	
		CLASS
			NAME "highlited"
			EXPRESSION  "%parcel_nid%"  
			STYLE
				COLOR 80 150 80
			END
			STYLE
				OUTLINECOLOR 0 100 0
				WIDTH 3
			END
		END #class


		#--------------------------
		# Normal elemek		
		#--------------------------
		CLASS
			NAME "normal"
			STYLE
				COLOR 100 255 100
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END

			#A megjelenitendo hrsz formatuma
			TEXT '[hrsz]'
			LABEL    
				ANGLE [title_angle]    #hrsz dolesszoge
				COLOR 255 0 0                           
				SIZE 11

				FORCE FALSE
				PARTIALS FALSE
				FONT arial-bold
				TYPE TRUETYPE
				POSITION CR					
				MINDISTANCE 500

				STYLE
					GEOMTRANSFORM 'labelpoly'
					 COLOR 200 200 200
					OFFSET 0 0
				END #style
                         END #label
		END #class

	END #layer


	#=================
	#
	# PARCEL POINT for VIEW
	#
	#=================

	LAYER
		NAME "parcel_point_view"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT p.nid, f.geom FROM main.im_parcel AS p, main.tp_face AS f WHERE p.projection=f.gid) AS subquery USING UNIQUE nid USING srid=2370"

		STATUS OFF #DEFAULT
		TYPE POINT
#		TOLERANCE 1

		PROJECTION
			"init=epsg:2370"
		END

		CLASS
			NAME "normal3"
			STYLE
				SYMBOL 'circle'
				COLOR 255 0 0
				OUTLINECOLOR 250 250 0
				WIDTH 3
			END
#			STYLE
#				SYMBOL 'circle'
#				OUTLINECOLOR 0 0 0
#				WIDTH 7
#			END
		END #class
	END #layer


	#/////////////////////////////////////////////////////////
	#/////////////                    ////////////////////////
	#////////////  BUILDING /////////////////////////
	#///////////                    //////////////////////////
	#/////////////////////////////////////////////////////////

	#_____________________________________
	#
	# BUILDING POLYGON for IDENTIFY
	#
	#_____________________________________

	LAYER
		NAME "building_identify"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
#		DATA "geom FROM 
#			(SELECT 'building' AS sel_name, b.nid AS sel_nid, f.geom, CASE (hrsz_eoi IS NULL) WHEN TRUE THEN $$ $$ ELSE hrsz_eoi END AS hrsz_eoi, b.title_angle 
#			FROM main.im_building AS b, main.tp_face AS f 
#			WHERE b.projection=f.gid) 
#			AS subquery USING UNIQUE sel_nid USING srid=2370"
		DATA "geom FROM (SELECT 'im_building' AS selected_name, b.nid AS selected_nid, f.geom  FROM main.im_building AS b, main.tp_face AS f WHERE b.projection=f.gid) AS subquery USING UNIQUE selected_nid USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		#Lekerdezeshez szukseges tempalte fajl, specialis formaban
		TEMPLATE 'templates/identify.html'
	END #layer


	#_____________________________________
	#
	# BUILDING POLYGON for VIEW
	#
	#_____________________________________

	LAYER
		NAME "building_view"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"
			
		DATA "geom from (SELECT b.nid, f.geom, CASE (hrsz_eoi IS NULL) WHEN TRUE THEN $$ $$ ELSE hrsz_eoi END AS hrsz_eoi, b.title_angle FROM main.im_building AS b, main.tp_face AS f WHERE b.projection=f.gid) AS subquery USING UNIQUE nid USING srid=2370"

		STATUS OFF #DEFAULT
		TYPE POLYGON
		TOLERANCE 1

		PROJECTION
			"init=epsg:2370"
		END

		VALIDATION
			"highlighted_building_nid"  "^[0-9]+$"	#!!! Ez kell, mert kulonben nem lenne ervenyes az EXPRESSION parameteratadas
		END

		#--------------------------
		# Kiemelt elemek		
		#--------------------------
		CLASSITEM "nid"	
		CLASS
			NAME "highlited"
			EXPRESSION  "%highlighted_building_nid%"  
			STYLE
				COLOR 80 80 150
			END
			STYLE
				OUTLINECOLOR 0 0 100
				WIDTH 3
			END
		END #class

		#--------------------------
		# Norm√°l elemek		
		#--------------------------
		CLASS
			NAME "normal"
			STYLE
				COLOR 000 000 255
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END

			#A megjelenitendo hrsz formatuma
			TEXT '[hrsz_eoi]'
			LABEL    
				ANGLE [title_angle]    #hrsz dolesszoge

				COLOR 255 255 0                           
				FORCE FALSE
				PARTIALS FALSE
				FONT arial
				TYPE TRUETYPE
				POSITION CR					
				MINDISTANCE 1300
				SIZE 15

				STYLE
					GEOMTRANSFORM 'labelpoly'
					 COLOR 200 200 200
					OFFSET 0 0
				END
                         END	

		END #class

	END #layer


	#/////////////////////////////////////////////////////////
	#//////////                                             //
	#////////  TARSASHAZAK UNIT-JAI    ///
	#///////                                              ////
	#/////////////////////////////////////////////////////////

	#_____________________________________
	#
	# BUILDING UNIT for IDENTIFY
	#
	#_____________________________________

	LAYER
		NAME "building_unit_identify"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"			
		DATA "geom FROM (SELECT 'im_building' AS selected_name, b.nid AS selected_nid, f.geom  FROM main.im_building AS b, main.tp_face AS f WHERE b.projection=f.gid) AS subquery USING UNIQUE selected_nid USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1
		PROJECTION
			"init=epsg:2370"
		END
		#Lekerdezeshez szukseges tempalte fajl, specialis formaban
#		TEMPLATE 'templates/identify.html'
	END #layer


	#_____________________________________
	#
	# BUILDING UNIT for VIEW
	#
	#_____________________________________

	LAYER
		NAME "building_unit_view"

		CONNECTIONTYPE postgis
		CONNECTION "host=localhost password=tdc user=tdc dbname=tdc"
			
DATA "geom FROM (SELECT unit.nid, face.geom AS geom FROM main.im_building_individual_unit unit, main.im_building_individual_unit_level unitlevel, main.tp_face face WHERE unit.im_building=unitlevel.im_building AND unit.hrsz_unit=unitlevel.hrsz_unit AND unitlevel.projection=face.gid AND unitlevel.im_levels=%visible_building_levels% ) AS subquery USING UNIQUE nid USING srid=2370"

#DATA "geom from (SELECT b.nid, f.geom, CASE (hrsz_eoi IS NULL) WHEN TRUE THEN $$ $$ ELSE hrsz_eoi END AS hrsz_eoi, b.title_angle FROM main.im_building AS b, main.tp_face AS f WHERE b.projection=f.gid AND nid=-1) AS subquery USING UNIQUE nid USING srid=2370"

		STATUS OFF
		TYPE POLYGON
		TOLERANCE 1

		PROJECTION
			"init=epsg:2370"
		END

		VALIDATION
			"visible_building_levels"  "^[0-9]+$"	#Ez a parameter mondja meg, hogy melyik epuletszint latszodhat
			"highlighted_unit_nid"  "^[0-9]+$"	#Ez a parameter mondja meg, hogy melyik unitot emeljuk ki
		END

		#--------------------------
		# Kiemelt elemek		
		#--------------------------
		CLASSITEM "nid"	
		CLASS
			NAME "highlited"
			EXPRESSION  "%highlighted_unit_nid%"  
			STYLE
				COLOR 0 75 165
			END
			STYLE
				OUTLINECOLOR 0 25 61
				WIDTH 3
			END
		END #class

		#--------------------------
		# Norm√°l elemek		
		#--------------------------
		CLASS
			NAME "normal"
			STYLE
				COLOR 000 100 255
			END
			STYLE
				OUTLINECOLOR 0 0 0
				WIDTH 1
			END
		END #class
	END #layer




	#==========
	#
	# ORSZAGHATAR
	#
	#==========

#	LAYER
#		NAME "border"					#layer neve
#		DATA border
#		STATUS DEFAULT
#		TYPE LINE
#	
#		FILTER "1=1"
#		PROJECTION
#			"init=epsg:2370"
#		END
#
#		CLASS
#			STYLE
#				COLOR 0 255 0
#				WIDTH 1
#			END
#		END
#	END #layer



 # End of LAYER DEFINITIONS -------------------------------

END # end of map file


